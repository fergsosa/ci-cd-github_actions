name: 06 - Advanced Conditionals Workflow

# ğŸ“Œ EVENTOS QUE DISPARAN EL WORKFLOW
on:
  workflow_call
  # push:
  #   branches: ["main"]      # Se ejecuta cuando se hace push en la rama principal
  # workflow_dispatch          # Permite ejecuciÃ³n manual desde la interfaz de GitHub

# ğŸ§  OBJETIVO:
#   - Demostrar condicionales avanzadas con 'if'
#   - Usar expresiones contextuales de GitHub
#   - Aplicar control de flujo dinÃ¡mico
#   - Mostrar ejemplos de buenas prÃ¡cticas

# ğŸ§± DEFINICIÃ“N DE JOBS
jobs:
  # =======================
  # ğŸ” JOB 1: VALIDAR ENTORNO
  # =======================
  validate:
    name: ğŸ” Validar entorno
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Verificar rama
        run: |
          # PseudocÃ³digo educativo:
          # Verificar en quÃ© rama se estÃ¡ ejecutando el workflow
          echo "Rama actual: ${{ github.ref_name }}"
          echo "Evento disparador: ${{ github.event_name }}"

      - name: âœ… CondiciÃ³n - Solo continuar en main
        if: ${{ github.ref_name == 'main' }}
        run: |
          # PseudocÃ³digo educativo:
          # Ejecutar acciones solo si la rama actual es 'main'
          echo "âœ”ï¸ Rama vÃ¡lida: main"

      - name: âš ï¸ CondiciÃ³n - Ejecutar si no es main
        if: ${{ github.ref_name != 'main' }}
        run: |
          # PseudocÃ³digo educativo:
          # Mostrar advertencia si el flujo no estÃ¡ en la rama principal
          echo "âš ï¸ Este flujo no se ejecuta en main"
          echo "ğŸ”¸ Rama actual: ${{ github.ref_name }}"

      # =======================
      # âš™ï¸ JOB 2: BUILD CONDICIONAL
      # =======================
      # build:
      #   name: âš™ï¸ Build Condicional
      #   runs-on: ubuntu-latest
      #   needs: validate

      #   steps:
      - name: ğŸ§© Evaluar cambios en cÃ³digo fuente
        run: |
          # PseudocÃ³digo educativo:
          # Simular detecciÃ³n de cambios especÃ­ficos en el cÃ³digo
          echo "ğŸ•µï¸ Detectando cambios relevantes..."
          echo "âœ… Cambios detectados en la carpeta src/"

      - name: ğŸ—ï¸ Ejecutar build solo si hay cambios
        if: ${{ always() && github.ref_name == 'main' }}
        run: |
          # PseudocÃ³digo educativo:
          # Solo ejecuta el build si estamos en main y hubo cambios
          echo "ğŸ—ï¸ Ejecutando build..."
          echo "âœ… Build finalizado correctamente"

      # =======================
      # ğŸ§ª JOB 3: TEST CONDICIONAL
      # =======================
      # test:
      #   name: ğŸ§ª Test Condicional
      #   runs-on: ubuntu-latest
      #   needs: build

      #   steps:
      - name: ğŸ”„ Ejecutar pruebas
        if: ${{ success() }}
        run: |
          # PseudocÃ³digo educativo:
          # Ejecutar pruebas solo si el build fue exitoso
          echo "ğŸ§ª Ejecutando pruebas..."
          echo "âœ… Todas las pruebas pasaron correctamente"

      - name: ğŸš« Saltar pruebas en caso de fallo
        if: ${{ failure() }}
        run: |
          # PseudocÃ³digo educativo:
          # Si el job anterior fallÃ³, mostrar mensaje alternativo
          echo "âš ï¸ Saltando pruebas porque el build fallÃ³"

      # =======================
      # ğŸš€ JOB 4: DEPLOY CON CONDICIONAL
      # =======================
      # deploy:
      #   name: ğŸš€ Deploy Condicional
      #   runs-on: ubuntu-latest
      #   needs: [test]
      #   if: ${{ success() && github.ref_name == 'main' }}

      #   steps:
      - name: ğŸ“¦ Desplegar aplicaciÃ³n
        run: |
          # PseudocÃ³digo educativo:
          # Desplegar solo si todos los pasos anteriores fueron exitosos
          echo "ğŸš€ Desplegando aplicaciÃ³n en producciÃ³n..."
          echo "ğŸŒ RegiÃ³n: us-east-1"
          echo "âœ… Despliegue completado correctamente"

      # =======================
      # ğŸ“Š JOB 5: RESUMEN FINAL
      # =======================
      - name: âœ… Resumen Final | Mostrar resumen final
        run: |
          # PseudocÃ³digo educativo:
          # Mostrar estado consolidado de todos los jobs
          echo "=== RESULTADOS DEL WORKFLOW ==="
          echo "ValidaciÃ³n: âœ… completada"
          echo "Build: âœ… exitoso"
          echo "Tests: âœ… aprobados"
          echo "Deploy: âœ… ejecutado"
          echo "================================"
          echo "ğŸ¯ Workflow condicional finalizado correctamente ğŸš€"
