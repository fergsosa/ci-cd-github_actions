#! ğŸ§© Workflow Intermedio - Variables y Secrets en GitHub Actions
#
# PROPÃ“SITO:
#   Aprender a trabajar con:
#   - Variables de entorno (env)
#   - Secrets y valores sensibles
#   - Condicionales (if)
#   - Contextos de GitHub
#
# TRIGGER:
#   Se ejecuta en cada push o manualmente desde la interfaz de Actions
#
# NIVEL: ğŸŸ¡ Intermedio
# --------------------------------------------------------------

name: 02 - Variables and Secrets

#! ğŸ“Œ Eventos que activan este workflow
on: workflow_call
# on:
#   push:
#     branches:
#       # - main
#       - dev
#   workflow_dispatch:

#! ğŸ§± DefiniciÃ³n de trabajos (jobs)
jobs:
  variables-demo:
    name: Variables y Secrets
    runs-on: ubuntu-latest

    # ğŸŒ Variables de entorno (accesibles para todos los pasos del job)
    env:
      ENVIRONMENT: development
      AUTHOR: "GitHub Actions"
      APP_VERSION: "1.0.0"

    steps:
      # Paso 1: Mostrar variables definidas en env
      - name: ğŸ”§ Mostrar variables de entorno
        run: |
          echo "Entorno: $ENVIRONMENT"
          echo "Autor: $AUTHOR"
          echo "VersiÃ³n: $APP_VERSION"

      # Paso 2: Mostrar variables del contexto de GitHub
      - name: ğŸ” Mostrar contexto de GitHub
        run: |
          echo "Repositorio: ${{ github.repository }}"
          echo "Branch actual: ${{ github.ref_name }}"
          echo "Evento que disparÃ³ el workflow: ${{ github.event_name }}"
          echo "Commit SHA: ${{ github.sha }}"

      # Paso 3: Uso de secrets
      # ğŸ”’ Los secrets se configuran desde:
      #     Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
      - name: ğŸ” Uso de secrets
        env:
          API_KEY: ${{ secrets.API_KEY }}
        run: |
          echo "Usando API_KEY (no se mostrarÃ¡ su valor por seguridad)"
          echo "Longitud aproximada: ${#API_KEY}"

      # Paso 4: Variables locales (definidas solo para este paso)
      - name: ğŸ§  Variables locales
        run: |
          TEMP_VAR="valor temporal"
          echo "Esta variable solo existe dentro de este paso: $TEMP_VAR"

      # Paso 5: Uso de expresiones condicionales
      - name: âš™ï¸ Condicionales bÃ¡sicas
        if: env.ENVIRONMENT == 'development'
        run: echo "âœ… Este paso solo se ejecuta si el entorno es 'development'"

      - name: ğŸš« Paso omitido en producciÃ³n
        if: env.ENVIRONMENT == 'production'
        run: echo "âŒ Este paso no se ejecutarÃ¡ en entorno de desarrollo"

      # Paso 6: Exportar una variable entre pasos usando outputs
      - name: ğŸ“¤ Generar valor de salida
        id: generate
        run: echo "result=42" >> $GITHUB_OUTPUT

      - name: ğŸ“¥ Leer variable generada en paso anterior
        run: |
          echo "El resultado del paso anterior fue: ${{ steps.generate.outputs.result }}"

      - name: âœ… Resumen | Workflow completado
        run: |
          echo "ğŸ¯ Workflow de variables y secrets ejecutado correctamente"
          echo "ğŸ“˜ Siguiente paso: explora 03-reusable-build.yml"
